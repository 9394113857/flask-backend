# ----------------------------------------------------
# âœ… FLASK MIGRATION SETUP SCRIPT (PowerShell)
# ----------------------------------------------------

# ðŸ”¹ Step 1: Check & Delete Old Migrations Folder
if (Test-Path -Path "migrations") {
    Write-Output "`nâœ” migrations folder exists. Deleting it to start fresh..."
    Remove-Item -Recurse -Force migrations
} else {
    Write-Output "`nâœ” migrations folder does not exist. Proceeding..."
}

# ðŸ”¹ Step 2: Delete Old SQLite Database File
if (Test-Path -Path "pythonlogin.db") {
    Write-Output "`nâœ” pythonlogin.db exists. Deleting the database file..."
    Remove-Item pythonlogin.db
} else {
    Write-Output "`nâœ” pythonlogin.db does not exist. Proceeding..."
}

# ðŸ”¹ Step 3: Set the FLASK_APP environment variable
$env:FLASK_APP = "run.py"
Write-Output "`nâœ” FLASK_APP set to run.py"

# ðŸ”¹ Step 4: Initialize the Migration Environment
Write-Output "`nðŸš€ Running: flask db init"
flask db init

# ðŸ”¹ Step 5: Generate a Migration Script
Write-Output "`nðŸš€ Running: flask db migrate -m 'Initial migration.'"
flask db migrate -m "Initial migration."

# ðŸ”¹ Step 6: Apply Migrations to the Database
Write-Output "`nðŸš€ Running: flask db upgrade"
flask db upgrade

# ðŸ”¹ Step 7: Show Current Migration Version
Write-Output "`nðŸ”Ž Current migration version:"
flask db current

# ðŸ”¹ Step 8: List All Migration History (Optional)
Write-Output "`nðŸ§¾ Full migration history:"
flask db history